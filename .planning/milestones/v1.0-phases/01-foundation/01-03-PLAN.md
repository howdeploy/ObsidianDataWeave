---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - rules/atomization.md
  - rules/taxonomy.md
autonomous: true
requirements:
  - RULE-01
  - RULE-02
  - RULE-03

must_haves:
  truths:
    - "rules/atomization.md contains distilled atomic note principles with few-shot examples"
    - "rules/taxonomy.md contains tag usage, MOC structure, wikilink, and frontmatter rules with few-shot examples"
    - "Both rules files are 400-600 words each (concise operating instructions, not verbose docs)"
    - "Rules are in English; examples can include bilingual content (EN rules, RU examples)"
    - "Rules are structured as direct Claude operating instructions that Phase 2 SKILL.md can load into context"
  artifacts:
    - path: "rules/atomization.md"
      provides: "Atomic note principles + few-shot examples"
      min_lines: 40
    - path: "rules/taxonomy.md"
      provides: "Tag, MOC, wikilink, and frontmatter rules + few-shot examples"
      min_lines: 40
  key_links:
    - from: "rules/atomization.md"
      to: "Phase 2 SKILL.md"
      via: "Loaded into Claude context as operating instructions for note splitting"
      pattern: "one idea.*one note|150-600 words"
    - from: "rules/taxonomy.md"
      to: "tags.yaml"
      via: "References tag format from tags.yaml; instructs Claude on tag selection"
      pattern: "tags.yaml|domain/subtag"
    - from: "rules/taxonomy.md"
      to: "Phase 2 SKILL.md"
      via: "Loaded into Claude context as operating instructions for tagging and linking"
      pattern: "wikilink|MOC|frontmatter"
---

<objective>
Distill the two reference .docx files into concise rules/*.md files that Claude can load as operating instructions for atomization, tagging, and linking in Phase 2.

Purpose: These rules encode the user's chosen methodology (MOC + Zettelkasten) into machine-readable instructions. Without them, Phase 2 Claude has no methodology guidance and would produce inconsistent output.
Output: rules/atomization.md, rules/taxonomy.md
</objective>

<execution_context>
@/home/kosya/.claude/get-shit-done/workflows/execute-plan.md
@/home/kosya/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Distill atomization.md from reference .docx files</name>
  <files>rules/atomization.md</files>
  <action>
Read both reference .docx files from project root:
- `Архитектура Второго мозга: Синхронизация Obsidian и Claude MCP.docx`
- `Smart Connections: Интеллектуальный мозг вашей базы Obsidian.docx`

Parse them with python-docx (or use parse_docx.py from Plan 02 if available, otherwise read directly — the content is also summarized in RESEARCH.md Discovery 1).

Distill into `rules/atomization.md` — direct operating instructions for Claude. Target: 400-600 words.

**Must include these sections:**

1. **Core Principle** — One note = one idea that stands alone. Source: "Архитектура Второго мозга" Part 1 (atomicity rules, one-source-one-note).

2. **Constraints** — Hard limits Claude must follow:
   - Length: 150-600 words per atomic note
   - Title: noun phrase, not a sentence ("Vector embeddings in Smart Connections" not "How Smart Connections uses vector embeddings")
   - Focus: one claim, one concept, or one technique per note
   - Self-contained: note must make sense without reading any other note
   - Source: "Архитектура" formatting rules + "Smart Connections" best practices (atomicity, own words)

3. **Splitting Heuristics** — When to split a section into multiple notes:
   - Section covers 2+ distinct ideas
   - Section exceeds 600 words
   - Section contains a definition AND its application (split into two)

4. **Few-Shot Examples** — At least 2 examples. Per user decision: EN rules, RU examples from actual reference content.
   - **Good example:** A properly atomic note (title, body, why it's good)
   - **Bad example:** A note that's too broad, with fix showing how to split it

Source the examples from actual content in the reference .docx files (Smart Connections plugin features, Zettelkasten principles from Архитектура doc).

**Format:** Markdown with clear headers. Written as imperative instructions ("Split sections that...", "Title each note as..."). NOT as documentation or explanation.

**Word count check:** After writing, count words. If > 600, cut verbose explanations. If < 400, add another few-shot example.
  </action>
  <verify>
Run: `wc -w rules/atomization.md` — must be between 400 and 600 words (allow 350-650 range for flexibility).

Run: `grep -c '###' rules/atomization.md` — must have at least 3 subsections.

Run: `grep -ci 'example\|good\|bad' rules/atomization.md` — must have examples (at least 2 matches).

Run: `head -5 rules/atomization.md` — first line should be a markdown heading.
  </verify>
  <done>rules/atomization.md contains 400-600 word distilled operating instructions with core principles, constraints, splitting heuristics, and few-shot examples sourced from the two reference .docx files.</done>
</task>

<task type="auto">
  <name>Task 2: Distill taxonomy.md from reference .docx files</name>
  <files>rules/taxonomy.md</files>
  <action>
Read both reference .docx files (same sources as Task 1).

Distill into `rules/taxonomy.md` — direct operating instructions for tagging, MOC structure, wikilinks, and YAML frontmatter. Target: 400-600 words.

**Must include these sections:**

1. **Tag Rules** — How Claude selects tags:
   - Read canonical tags from tags.yaml (reference the file)
   - Format: `domain/subtag` (e.g., `tech/ai`, `productivity/pkm`)
   - Each note gets 2-5 tags
   - Prefer specific over generic (`tech/llm` over `tech/ai` when discussing LLMs)
   - If no tag fits, propose a new one and log it (auto-expansion rule from user decision)
   - Source: "Smart Connections" contextual indexing + best practices

2. **Wikilink Rules** — How Claude creates links between notes:
   - Use `[[Note Title]]` syntax (Obsidian standard)
   - Link only to note titles that exist within the same processing run
   - 3-7 wikilinks per note (not more — avoid link spam)
   - Link based on semantic relationship, not keyword matching
   - Source: "Архитектура Второго мозга" interlinking rules, backlinks

3. **MOC Rules** — How Claude structures Maps of Content:
   - One MOC per processed document
   - MOC mirrors source document heading structure (H1/H2 as two-level hierarchy)
   - MOC links to all atomic notes generated from that document
   - MOC title: source document name (cleaned)
   - Source: "Архитектура" MOC usage rules

4. **YAML Frontmatter Schema** — Locked fields (per STATE.md decision):
   - `tags`: list of `domain/subtag` strings
   - `date`: ISO 8601 (YYYY-MM-DD)
   - `source_doc`: original .docx filename
   - `note_type`: "atomic" | "moc" | "source"
   - No additional fields in v1 (additions = breaking change)

5. **Few-Shot Example** — At least 1 complete note example showing frontmatter + body + wikilinks + tags working together. Use bilingual content per user decision (EN rules, RU example).

**Format:** Same as atomization.md — imperative instructions, not documentation.

**Word count check:** Target 400-600 words.
  </action>
  <verify>
Run: `wc -w rules/taxonomy.md` — must be between 400 and 600 words (allow 350-650 range).

Run: `grep -c '###' rules/taxonomy.md` — must have at least 4 subsections.

Run: `grep -ci 'tags.yaml\|wikilink\|moc\|frontmatter' rules/taxonomy.md` — must cover all four topics (at least 4 matches).

Run: `grep -c '\[\[' rules/taxonomy.md` — must have wikilink examples (at least 1 match).

Run: `grep 'note_type' rules/taxonomy.md` — must reference the locked frontmatter schema.
  </verify>
  <done>rules/taxonomy.md contains 400-600 word distilled operating instructions covering tag selection, wikilink rules, MOC structure, and YAML frontmatter schema with at least one complete few-shot example.</done>
</task>

</tasks>

<verification>
1. Both files exist: `ls rules/atomization.md rules/taxonomy.md`
2. Word counts in range: `wc -w rules/*.md` — each between 350-650 words
3. Both files have few-shot examples: `grep -l 'example\|Example' rules/*.md` — both files match
4. taxonomy.md references tags.yaml: `grep 'tags.yaml' rules/taxonomy.md`
5. taxonomy.md includes locked frontmatter fields: `grep -E 'tags|date|source_doc|note_type' rules/taxonomy.md` — all four present
6. atomization.md has splitting constraints: `grep -E '150.*600|word' rules/atomization.md`
7. Rules are in English: `file rules/*.md` shows UTF-8 text (examples may contain Cyrillic, but rules are English)
</verification>

<success_criteria>
- rules/atomization.md has atomic note principles, constraints (150-600 words, noun-phrase titles), splitting heuristics, and 2+ few-shot examples
- rules/taxonomy.md has tag rules (referencing tags.yaml), wikilink rules (3-7 per note), MOC structure, YAML frontmatter schema (locked v1 fields), and 1+ complete note example
- Both files are 400-600 words (concise operating instructions, not verbose documentation)
- Both files are written as imperative Claude instructions, not as explanatory documentation
- Content is distilled from the two reference .docx files, not invented
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
